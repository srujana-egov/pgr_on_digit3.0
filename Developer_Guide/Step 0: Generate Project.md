# Generate Project Using API Specs - In 1 command! (Almost)

This page provides detailed steps for generating projects using the given API specifications via OpenAPI generator. 

## Steps

### 0. Clone this repo.
git clone https://github.com/digitnxt/digit3.git

### 1. Navigate to the folder 'generate-project'

cd digit3/Developer_Guide
ls

Copy this folder locally as 'generate-project'.

### 2. Use this command to generate most of your project stub.

```bash
openapi-generator generate \
  -g spring \
  -i pgr.yaml \
  -o generated-pgr \
  -t ./final-custom-templates \
  --api-package com.example.pgrown30.web.controllers \
  --model-package com.example.pgrown30.web.models \
  --invoker-package com.example.pgrown30.web \
  --additional-properties=\
packageName=com.example.pgrown30,\
servicePackage=com.example.pgrown30.web.service,\
delegatePattern=true,\
useSpringBoot3=true,\
groupId=com.example,\
artifactId=pgrown30,\
artifactVersion=0.0.1-SNAPSHOT,\
name=pgrown30,\
description="PGR Service generated from YAML",\
dbName=pgrown,\
dbSchema=public,\
dbUser=postgres,\
dbPassword=1234,\
serverPort=8083,\
idgenTemplateCode=pgr,\
WorkflowProcessCode=PGR6 \
  --global-property=apis,models,supportingFiles
````
Replace these flags as per the project you are genereating:

Geberal project configuration:
packageName
servicePackage
groupId
artifactId
artifactVersion\
name
description

Database configuration:
dbName
dbSchema
dbUser
dbPassword
serverPort

IDGen configuaration:
idgenTemplateCode

Workflow Configuration:
WorkflowProcessCode

Leave these as true:
delegatePattern=true,\
useSpringBoot3=true,\

Your pom.xml, application.properties, controller file and service interface are all generated. 
Note: The service interface will be generated under the controllers folder with 'delegate' in the name. 

### 3. Generating repository layer

Use the command:

```python
 python3 scripts/generate_repositories.py pgr.yaml generated-pgr/src/main/java
```

This does the following:
- Reads the OpenAPI YAML.
- Detects all schemas under components/schemas.
- Determines which schemas are DOMAIN ENTITIES based on:
    • having string fields OR uuid OR identifiers
    • being referenced by ServiceWrapper or ServiceResponse
- Detects primary ID field automatically:
    • id, serviceRequestId, tenantId, <name>Id, etc.
    • OR x-id-field in YAML override
- Auto-detects package structure from generated Java models
- Writes repository files to:
      <base-package>/repository/<SchemaName>Repository.java

Awesome! Repository layer is generated. 

### 4. Cleanup models

Use the command:

```python
python3 scripts/cleanup_models.py /Users/srujana/Desktop/gen-pgr/generated-pgr/src/main/java/com/example/pgrown30/web/models
````

This does the following:
- For each .java file in the given directory:
  - Reads package name.
  - Finds "private" field declarations and their types.
  - Finds @JsonProperty("...") usage on getters to preserve JSON property names when present.
  - Backs up original file to filename.java.bak
  - Overwrites the file with a compact Lombok-style class:
      - imports: JsonProperty + Lombok annotations
      - @Data @NoArgsConstructor @AllArgsConstructor @Builder
      - field declarations annotated with @JsonProperty("jsonName")
- Prints a summary of files processed.
  
Now all the models have just the information we need. 

### 5. Cleanup Application.java

Use the command:

```bash
chmod +x scripts/fix-application.sh
./scripts/fix-application.sh

````

### 6. Generate config files.

Use the commands:

```bash
python3 scripts/generate_digit_client_config.py generated-pgr/src/main/java
python3 scripts/generate_security_config.py generated-pgr/src/main/java  

````
### 7. Import in IDE.

Now you have all the generated files you need! Open the generated-pgr folder in the IDE of your choice. Make sure it is using this folder structure:
<img width="508" height="535" alt="Screenshot 2025-11-19 at 1 29 48 PM" src="https://github.com/user-attachments/assets/90b6f6b3-2107-4141-9710-3a0b09d6b3dc" />
Note: You may need to move some files around to get this. 

Add a folder service and move the ApiDelegate file under it. 
Rename the ApiDelegate file -> {{packageName}}Service.java. 
Add another folder impl under service folder. 

Note: Preferably delete all the other files generated by the generator at this point to avoid dependency errors. 

### 8. Add Client Library jar file in your initial created folder.
Link here: Developer_Guide/digit-client-1.0.0.jar

### 9. Perform a maven update once the spring boot version is updated.
Command: mvn -U clean install
